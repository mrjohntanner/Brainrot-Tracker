<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SAB Brainrot Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0b0f14;
  --panel:#0f1620;
  --panel2:#111b27;
  --text:#e8eef7;
  --muted:#8b97aa;
  --accent:#4da3ff;
  --radius:14px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:14px 20px;
  background:linear-gradient(180deg,#0f1620,#0b0f14);
  display:flex;
  gap:14px;
}
header button{
  background:none;
  border:none;
  color:var(--muted);
  font-size:15px;
  cursor:pointer;
}
header button.active{color:var(--accent)}
main{padding:20px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(190px,1fr));
  gap:16px;
}
.card{
  background:var(--panel2);
  border-radius:var(--radius);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.rarity-bar{
  height:6px;
  border-radius:10px;
  margin:-12px -12px 8px -12px;
}
.card img{
  width:100%;
  height:120px;
  object-fit:contain;
  background:#0b0f14;
  border-radius:10px;
  padding:8px;
}
.card b{font-size:16px}
.card small{color:var(--muted)}
button,select,input{
  background:#0b0f14;
  color:var(--text);
  border:1px solid rgba(255,255,255,.15);
  border-radius:8px;
  padding:6px;
}
button{cursor:pointer}

/* rarity colors */
.r-common{background:linear-gradient(90deg,#1e7f43,#34d399)}
.r-rare{background:linear-gradient(90deg,#1e3a8a,#3b82f6)}
.r-epic{background:linear-gradient(90deg,#4c1d95,#a855f7)}
.r-legendary{background:linear-gradient(90deg,#92400e,#facc15)}
.r-mythic{background:linear-gradient(90deg,#6d28d9,#c084fc)}
.r-brainrot-god{background:linear-gradient(90deg,red,orange,yellow,green,blue,indigo,violet)}
.r-secret{background:linear-gradient(90deg,#000,#fff)}
.r-og{background:linear-gradient(90deg,#facc15,#000)}
.r-festive{background:linear-gradient(90deg,#dc2626,#16a34a)}
.r-admin{background:linear-gradient(90deg,#dc2626,#facc15)}
</style>
</head>
<body>

<header>
  <button id="tabIndex" class="active">Index</button>
  <button id="tabBases">My Bases</button>
  <span style="margin-left:auto;color:#8b97aa;font-size:13px" id="status">Syncing…</span>
</header>

<main id="app"></main>

<script>
/* ================= STATE ================= */

let ALL_BRAINROTS = [];
let bases = JSON.parse(localStorage.getItem("sabBases")||"{}");
if(!Object.keys(bases).length) bases={Main:{brainrots:[]}};
Object.values(bases).forEach(b=>{
  b.brainrots=b.brainrots.map(x=>typeof x==="string"?{id:x,mutation:null,traits:[]}:x);
});

let tab="index";
let currentBase=Object.keys(bases)[0];
const app=document.getElementById("app");
const status=document.getElementById("status");

/* ================= HELPERS ================= */

function rarityClass(r){
  return "r-"+(r||"common").toLowerCase().replace(/\s+/g,"-");
}
function wikiImage(title){
  return `https://static.wikia.nocookie.net/stealabr/images/Special:FilePath/${title.replace(/ /g,"_")}`;
}

/* ================= WIKI AUTO SYNC ================= */

async function syncWiki(){
  try{
    status.textContent="Syncing from wiki…";

    const res = await fetch(
      "https://stealabr.fandom.com/api.php" +
      "?action=query" +
      "&list=categorymembers" +
      "&cmtitle=Category:Brainrots" +
      "&cmlimit=500" +
      "&format=json" +
      "&origin=*"
    );

    const data = await res.json();
    const pages = data.query.categorymembers;

    ALL_BRAINROTS = pages.map(p=>({
      id: p.pageid.toString(),
      name: p.title,
      rarity: "Common" // default, wiki is inconsistent
    }));

    localStorage.setItem("sabBrainrots",JSON.stringify(ALL_BRAINROTS));
    status.textContent="Ready (synced)";
    render();
  }catch(e){
    const cached = localStorage.getItem("sabBrainrots");
    if(cached){
      ALL_BRAINROTS = JSON.parse(cached);
      status.textContent="Offline (cached)";
      render();
    }else{
      status.textContent="Sync failed";
    }
  }
}

/* ================= UI ================= */

tabIndex.onclick=()=>{tab="index";render()};
tabBases.onclick=()=>{tab="bases";render()};

function render(){
  document.querySelectorAll("header button")
    .forEach(b=>b.classList.remove("active"));
  document.getElementById(tab==="index"?"tabIndex":"tabBases")
    .classList.add("active");

  tab==="index"?renderIndex():renderBases();
}

function renderIndex(){
  app.innerHTML=`
    <div class="grid">
      ${ALL_BRAINROTS.map(br=>`
        <div class="card">
          <div class="rarity-bar ${rarityClass(br.rarity)}"></div>
          <img loading="lazy"
               src="${wikiImage(br.name)}"
               onerror="this.style.display='none'">
          <b>${br.name}</b>
          <small>${br.rarity}</small>
          <button onclick="addBrainrot('${br.name}')">Add</button>
        </div>
      `).join("")}
    </div>
  `;
}

function renderBases(){
  app.innerHTML=`
    <div class="grid">
      ${bases[currentBase].brainrots.map(b=>`
        <div class="card">
          <b>${b.id}</b>
        </div>
      `).join("")}
    </div>
  `;
}

function addBrainrot(name){
  bases[currentBase].brainrots.push({id:name,mutation:null,traits:[]});
  localStorage.setItem("sabBases",JSON.stringify(bases));
}

/* ================= INIT ================= */

const cached = localStorage.getItem("sabBrainrots");
if(cached){
  ALL_BRAINROTS = JSON.parse(cached);
  status.textContent="Ready (cached)";
  render();
}
syncWiki();
</script>
</body>
</html>
