<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Steal a Brainrot – Brainrot Index</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0b1016;
  --panel:#131a24;
  --panel2:#182131;
  --border:#1f2a3d;
  --text:#eaf0f8;
  --muted:#9fb0c7;
  --radius:10px;
  --glow:0 0 0 1px rgba(255,255,255,.04),
         inset 0 1px 0 rgba(255,255,255,.04);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:radial-gradient(1200px 600px at top,#101827,#0b1016);
  color:var(--text);
}

/* ================= TOP BAR ================= */

header{
  display:flex;
  align-items:center;
  gap:16px;
  padding:14px 20px;
  background:linear-gradient(180deg,#151d2b,#101622);
  border-bottom:1px solid var(--border);
}

header .title{
  font-weight:600;
  font-size:15px;
}

header nav{
  display:flex;
  gap:6px;
}

header button{
  background:transparent;
  border:1px solid transparent;
  color:var(--muted);
  border-radius:6px;
  padding:6px 10px;
  cursor:pointer;
}
header button.active{
  color:#fff;
  background:rgba(255,255,255,.05);
  border-color:rgba(255,255,255,.08);
}

header .status{
  margin-left:auto;
  font-size:12px;
  color:var(--muted);
}

/* ================= LAYOUT ================= */

main{padding:18px}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:14px;
}

/* ================= CARD ================= */

.card{
  background:linear-gradient(180deg,var(--panel2),var(--panel));
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--glow);
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
  position:relative;
}

/* rarity accent (official style) */
.card::before{
  content:"";
  height:3px;
  border-radius:6px 6px 0 0;
  position:absolute;
  top:0; left:0; right:0;
}

/* thumbnail */
.thumb{
  width:100%;
  height:96px;
  background:#0b1016;
  border-radius:8px;
  border:1px solid #1b2638;
  display:flex;
  align-items:center;
  justify-content:center;
}
.thumb img{
  max-width:90%;
  max-height:90%;
  object-fit:contain;
}

/* text */
.name{
  font-size:14px;
  font-weight:600;
}
.rarity{
  font-size:12px;
  color:var(--muted);
}

/* button */
.card button{
  margin-top:auto;
  background:#0f1624;
  border:1px solid #22304a;
  color:#fff;
  border-radius:6px;
  padding:6px;
  cursor:pointer;
}

/* ================= RARITY COLORS ================= */

.r-common::before{background:#3fd18b}
.r-rare::before{background:#4fa3ff}
.r-epic::before{background:#b070ff}
.r-legendary::before{background:#ffd54a}
.r-mythic::before{background:#e2a6ff}
.r-secret::before{background:#ffffff}
.r-og::before{background:linear-gradient(90deg,#ffd54a,#000)}
.r-festive::before{background:linear-gradient(90deg,#d94141,#2fa86b)}
.r-admin::before{background:linear-gradient(90deg,#ff5555,#ffd54a)}
.r-brainrot-god::before{
  background:linear-gradient(
    90deg,
    red,orange,yellow,green,cyan,blue,violet
  );
}
</style>
</head>
<body>

<header>
  <div class="title">Steal a Brainrot – Brainrot Index</div>
  <nav>
    <button id="tabIndex" class="active">Index</button>
    <button id="tabCollection">Collection</button>
    <button onclick="resyncWiki()">Resync</button>
  </nav>
  <div class="status" id="status">Loading…</div>
</header>

<main id="app"></main>

<script>
/* ================= STATE ================= */

let brainrots=[];
let collection=new Set(
  JSON.parse(localStorage.getItem("sabCollection")||"[]")
);
let tab="index";

const app=document.getElementById("app");
const status=document.getElementById("status");

/* ================= HELPERS ================= */

function rarityClass(r){
  return "r-"+r.toLowerCase().replace(/\s+/g,"-");
}

function validTitle(t){
  if (/^\\d+$/.test(t)) return false;
  if (t.toLowerCase().includes("disambiguation")) return false;
  return true;
}

function detectRarity(cats){
  const order=[
    "Brainrot God","Admin","Secret",
    "Mythic","Legendary","Epic",
    "Rare","Common","OG","Festive"
  ];
  for(const r of order){
    if(cats.some(c=>c.includes(r))) return r;
  }
  return "Common";
}

/* ================= WIKI SYNC ================= */

async function resyncWiki(){
  status.textContent="Syncing wiki…";

  const res=await fetch(
    "https://stealabr.fandom.com/api.php"+
    "?action=query&list=categorymembers"+
    "&cmtitle=Category:Brainrots"+
    "&cmlimit=500&format=json&origin=*"
  );
  const pages=(await res.json()).query.categorymembers;

  const out=[];

  for(const p of pages.filter(p=>validTitle(p.title))){
    const r=await fetch(
      "https://stealabr.fandom.com/api.php"+
      "?action=query&prop=pageimages|categories"+
      "&piprop=original&cllimit=20"+
      "&format=json&origin=*"+
      "&titles="+encodeURIComponent(p.title)
    );
    const page=(await r.json()).query.pages;
    const d=page[Object.keys(page)[0]];

    out.push({
      id:p.pageid,
      name:p.title,
      image:d?.original?.source||null,
      rarity:detectRarity((d.categories||[]).map(c=>c.title))
    });
  }

  brainrots=out;
  localStorage.setItem("sabWikiCache",JSON.stringify(out));
  status.textContent="Up to date";
  render();
}

/* ================= UI ================= */

tabIndex.onclick=()=>{tab="index";render()};
tabCollection.onclick=()=>{tab="collection";render()};

function render(){
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(tab==="index"?"tabIndex":"tabCollection").classList.add("active");
  tab==="index"?renderIndex():renderCollection();
}

function renderIndex(){
  app.innerHTML=`
    <div class="grid">
      ${brainrots.map(b=>`
        <div class="card ${rarityClass(b.rarity)}">
          <div class="thumb">
            ${b.image?`<img src="${b.image}" loading="lazy">`:``}
          </div>
          <div class="name">${b.name}</div>
          <div class="rarity">${b.rarity}</div>
          <button onclick="toggle('${b.id}')">
            ${collection.has(b.id)?"Collected":"Add"}
          </button>
        </div>
      `).join("")}
    </div>
  `;
}

function renderCollection(){
  const owned=brainrots.filter(b=>collection.has(b.id));
  app.innerHTML=owned.length?`
    <div class="grid">
      ${owned.map(b=>`
        <div class="card ${rarityClass(b.rarity)}">
          <div class="name">${b.name}</div>
          <div class="rarity">${b.rarity}</div>
        </div>
      `).join("")}
    </div>
  `:`<p style="color:var(--muted)">No brainrots collected yet.</p>`;
}

/* ================= ACTIONS ================= */

function toggle(id){
  collection.has(id)?collection.delete(id):collection.add(id);
  localStorage.setItem("sabCollection",JSON.stringify([...collection]));
  render();
}

/* ================= INIT ================= */

const cache=localStorage.getItem("sabWikiCache");
if(cache){
  brainrots=JSON.parse(cache);
  status.textContent="Loaded from cache";
  render();
}
resyncWiki();
</script>

</body>
</html>
