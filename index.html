<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SAB Brainrot Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0b0f14;
  --panel:#0f1620;
  --panel2:#111b27;
  --text:#e8eef7;
  --muted:#8b97aa;
  --accent:#4da3ff;
  --radius:14px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}

/* ================= HEADER ================= */

header{
  padding:14px 20px;
  background:linear-gradient(180deg,#0f1620,#0b0f14);
  display:flex;
  gap:14px;
}

header button{
  background:none;
  border:none;
  color:var(--muted);
  font-size:15px;
  cursor:pointer;
}
header button.active{color:var(--accent)}

main{padding:20px}

/* ================= GRID ================= */

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(190px,1fr));
  gap:16px;
}

/* ================= CARD ================= */

.card{
  background:var(--panel2);
  border-radius:var(--radius);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* rarity accent bar */
.rarity-bar{
  height:6px;
  border-radius:10px;
  margin:-12px -12px 8px -12px;
}

/* image frame */
.card img{
  width:100%;
  height:120px;
  object-fit:contain;
  background:#0b0f14;
  border-radius:10px;
  padding:8px;
}

.card b{font-size:16px}
.card small{color:var(--muted)}

button,select,input{
  background:#0b0f14;
  color:var(--text);
  border:1px solid rgba(255,255,255,.15);
  border-radius:8px;
  padding:6px;
}

button{cursor:pointer}

/* ================= RARITY COLORS ================= */

.r-common{background:linear-gradient(90deg,#1e7f43,#34d399)}
.r-rare{background:linear-gradient(90deg,#1e3a8a,#3b82f6)}
.r-epic{background:linear-gradient(90deg,#4c1d95,#a855f7)}
.r-legendary{background:linear-gradient(90deg,#92400e,#facc15)}
.r-mythic{background:linear-gradient(90deg,#6d28d9,#c084fc)}
.r-brainrot-god{
  background:linear-gradient(90deg,red,orange,yellow,green,blue,indigo,violet)
}
.r-secret{background:linear-gradient(90deg,#000,#fff)}
.r-og{background:linear-gradient(90deg,#facc15,#000)}
.r-festive{background:linear-gradient(90deg,#dc2626,#16a34a)}
.r-admin{background:linear-gradient(90deg,#dc2626,#facc15)}

/* ================= BASE VIEW ================= */

.base-header{
  display:flex;
  gap:10px;
  align-items:center;
  margin-bottom:14px;
}

.br-row{
  margin-top:10px;
  border-top:1px solid rgba(255,255,255,.1);
  padding-top:10px;
}

.traits{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}

.traits label{font-size:12px}

.remove{
  font-size:12px;
  color:#ff8080;
  cursor:pointer;
}
</style>
</head>
<body>

<header>
  <button id="tabIndex" class="active">Index</button>
  <button id="tabBases">My Bases</button>
</header>

<main id="app"></main>

<script>
/* ================= DATA ================= */

const MUTATIONS=["None","Golden","Shadow","Corrupted"];
const TRAITS=["Fast","Lucky","Heavy","Glitched"];

/* ⚠️ THIS IS THE MASTER LIST
   Add ALL brainrots here to see them */
const ALL_BRAINROTS=[
  {id:"meowl",name:"Meowl",rarity:"Common"},
  {id:"festive_67",name:"Festive 67",rarity:"Festive"},
  {id:"brainrot_god",name:"Brainrot God",rarity:"Brainrot God"}
];

/* ================= HELPERS ================= */

function rarityClass(r){
  return "r-"+r.toLowerCase().replace(/\s+/g,"-");
}

function wikiImage(name){
  return `https://static.wikia.nocookie.net/stealabr/images/Special:FilePath/${name.replace(/ /g,"_")}`;
}

/* ================= STORAGE ================= */

function loadBases(){
  try{return JSON.parse(localStorage.getItem("sabBases"))||{}}
  catch{return{}}
}
function saveBases(){
  localStorage.setItem("sabBases",JSON.stringify(bases));
}

/* ================= MIGRATION ================= */

function normalize(list){
  return list.map(b=>typeof b==="string"?{id:b,mutation:null,traits:[]}:b);
}

/* ================= STATE ================= */

let bases=loadBases();
if(!Object.keys(bases).length)bases={Main:{brainrots:[]}};
Object.values(bases).forEach(b=>b.brainrots=normalize(b.brainrots));

let tab="index";
let currentBase=Object.keys(bases)[0];
const app=document.getElementById("app");

/* ================= TABS ================= */

tabIndex.onclick=()=>{tab="index";render()}
tabBases.onclick=()=>{tab="bases";render()}

function render(){
  document.querySelectorAll("header button")
    .forEach(b=>b.classList.remove("active"));
  document.getElementById(tab==="index"?"tabIndex":"tabBases")
    .classList.add("active");
  tab==="index"?renderIndex():renderBases();
}

/* ================= INDEX ================= */

function renderIndex(){
  app.innerHTML=`
    <div class="grid">
      ${ALL_BRAINROTS.map(br=>`
        <div class="card">
          <div class="rarity-bar ${rarityClass(br.rarity)}"></div>
          <img loading="lazy"
               src="${wikiImage(br.name)}"
               onerror="this.style.display='none'">
          <b>${br.name}</b>
          <small>${br.rarity}</small>
          <button onclick="addBrainrot('${br.id}')">Add</button>
        </div>
      `).join("")}
    </div>`;
}

function addBrainrot(id){
  bases[currentBase].brainrots.push({id,mutation:null,traits:[]});
  saveBases();
}

/* ================= BASES ================= */

function renderBases(){
  const missing=getMissing(currentBase).length;
  app.innerHTML=`
    <div class="base-header">
      <select onchange="changeBase(this.value)">
        ${Object.keys(bases).map(b=>`
          <option ${b===currentBase?"selected":""}>${b}</option>
        `).join("")}
      </select>
      <button onclick="exportBases()">Export</button>
      <input type="file" onchange="importBases(this.files[0])">
      <small>Missing: ${missing}</small>
    </div>

    ${bases[currentBase].brainrots.map((br,i)=>{
      const d=ALL_BRAINROTS.find(x=>x.id===br.id)||{};
      return`
        <div class="card br-row">
          <div class="rarity-bar ${rarityClass(d.rarity||"common")}"></div>
          <b>${d.name||br.id}</b>
          <small>${d.rarity||""}</small>

          Mutation:
          <select onchange="setMutation(${i},this.value)">
            ${MUTATIONS.map(m=>`
              <option ${br.mutation===m||(!br.mutation&&m==="None")?"selected":""}>${m}</option>
            `).join("")}
          </select>

          <div class="traits">
            ${TRAITS.map(t=>`
              <label>
                <input type="checkbox"
                  ${br.traits.includes(t)?"checked":""}
                  onchange="toggleTrait(${i},'${t}')"> ${t}
              </label>
            `).join("")}
          </div>

          <div class="remove" onclick="removeBrainrot(${i})">Remove</div>
        </div>`;
    }).join("")}
  `;
}

/* ================= LOGIC ================= */

function changeBase(b){currentBase=b;render()}
function setMutation(i,v){
  bases[currentBase].brainrots[i].mutation=v==="None"?null:v;
  saveBases();
}
function toggleTrait(i,t){
  const a=bases[currentBase].brainrots[i].traits;
  a.includes(t)?a.splice(a.indexOf(t),1):a.push(t);
  saveBases();
}
function removeBrainrot(i){
  bases[currentBase].brainrots.splice(i,1);
  saveBases();render();
}
function getMissing(b){
  const owned=new Set(bases[b].brainrots.map(x=>x.id));
  return ALL_BRAINROTS.filter(x=>!owned.has(x.id));
}

/* ================= IMPORT / EXPORT ================= */

function exportBases(){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob(
    [JSON.stringify(bases,null,2)],
    {type:"application/json"}
  ));
  a.download="sab-bases.json";
  a.click();
}
function importBases(f){
  const r=new FileReader();
  r.onload=e=>{
    bases=JSON.parse(e.target.result);
    saveBases();render();
  };
  r.readAsText(f);
}

/* ================= INIT ================= */

render();
</script>
</body>
</html>
