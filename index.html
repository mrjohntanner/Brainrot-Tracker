<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SAB Brainrot Archive</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --bg:#0b0e14;
  --panel:#121826;
  --panel2:#161d2e;
  --text:#e6ebf2;
  --muted:#9aa4b2;
  --accent:#5da9ff;
  --border:rgba(255,255,255,.08);
  --radius:10px;
}

/* ---------- Base ---------- */
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}
button,input{
  background:var(--panel2);
  border:1px solid var(--border);
  color:var(--text);
  border-radius:6px;
  padding:6px 10px;
}
button{cursor:pointer}

/* ---------- Header ---------- */
header{
  display:flex;
  align-items:center;
  gap:14px;
  padding:14px 20px;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}
header h1{
  font-size:16px;
  font-weight:600;
  margin:0;
}
header nav{
  display:flex;
  gap:8px;
}
header nav button.active{
  border-color:var(--accent);
  color:var(--accent);
}
header .status{
  margin-left:auto;
  font-size:12px;
  color:var(--muted);
}

/* ---------- Layout ---------- */
main{padding:20px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:12px;
}

/* ---------- Card ---------- */
.card{
  background:var(--panel2);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:10px;
  display:flex;
  gap:10px;
  align-items:center;
}

/* rarity stripe */
.card::before{
  content:"";
  width:4px;
  align-self:stretch;
  border-radius:4px;
}

/* image */
.thumb{
  width:48px;
  height:48px;
  border-radius:6px;
  background:#000;
  object-fit:contain;
}

/* text */
.meta{
  flex:1;
  display:flex;
  flex-direction:column;
}
.meta b{font-size:14px}
.meta small{font-size:12px;color:var(--muted)}

/* ---------- Rarity colors ---------- */
.r-common::before{background:#34d399}
.r-rare::before{background:#60a5fa}
.r-epic::before{background:#a855f7}
.r-legendary::before{background:#facc15}
.r-mythic::before{background:#c084fc}
.r-brainrot-god::before{
  background:linear-gradient(red,orange,yellow,green,blue,indigo,violet)
}
.r-secret::before{background:#fff}
.r-og::before{background:linear-gradient(#facc15,#000)}
.r-festive::before{background:linear-gradient(#dc2626,#16a34a)}
.r-admin::before{background:linear-gradient(#dc2626,#facc15)}
</style>
</head>
<body>

<header>
  <h1>SAB Brainrot Archive</h1>
  <nav>
    <button id="tabIndex" class="active">Index</button>
    <button id="tabCollection">Collection</button>
    <button id="tabSettings">Settings</button>
  </nav>
  <div class="status" id="status">Loading…</div>
</header>

<main id="app"></main>

<script>
/* ================= State ================= */
let tab="index";
let brainrots=[];
let collection=new Set(
  JSON.parse(localStorage.getItem("sabCollection")||"[]")
);
let showImages=true;

const app=document.getElementById("app");
const status=document.getElementById("status");

/* ================= Wiki Sync ================= */
function detectRarity(cats){
  const order=[
    "Brainrot God","Mythic","Legendary","Epic",
    "Rare","Common","Secret","OG","Festive","Admin"
  ];
  for(const r of order){
    if(cats.some(c=>c.includes(r))) return r;
  }
  return "Common";
}

async function syncWiki(){
  status.textContent="Syncing wiki…";
  const res=await fetch(
    "https://stealabr.fandom.com/api.php"+
    "?action=query&list=categorymembers"+
    "&cmtitle=Category:Brainrots"+
    "&cmlimit=500&format=json&origin=*"
  );
  const pages=(await res.json()).query.categorymembers;
  const out=[];
  for(const p of pages){
    const r=await fetch(
      "https://stealabr.fandom.com/api.php"+
      "?action=query&prop=pageimages|categories"+
      "&piprop=original&cllimit=20"+
      "&format=json&origin=*"+
      "&titles="+encodeURIComponent(p.title)
    );
    const page=(await r.json()).query.pages;
    const d=page[Object.keys(page)[0]];
    out.push({
      id:p.pageid,
      name:p.title,
      image:d?.original?.source||null,
      rarity:detectRarity((d.categories||[]).map(c=>c.title))
    });
  }
  brainrots=out;
  localStorage.setItem("sabWikiCache",JSON.stringify(out));
  status.textContent="Synced";
  render();
}

/* ================= UI ================= */
tabIndex.onclick=()=>{tab="index";render()};
tabCollection.onclick=()=>{tab="collection";render()};
tabSettings.onclick=()=>{tab="settings";render()};

function rarityClass(r){
  return "r-"+r.toLowerCase().replace(/\s+/g,"-");
}

function render(){
  if(tab==="index") renderIndex();
  if(tab==="collection") renderCollection();
  if(tab==="settings") renderSettings();
}

function renderIndex(){
  app.innerHTML=`
    <div class="grid">
      ${brainrots.map(b=>`
        <div class="card ${rarityClass(b.rarity)}">
          ${showImages&&b.image?`<img class="thumb" src="${b.image}">`:``}
          <div class="meta">
            <b>${b.name}</b>
            <small>${b.rarity}</small>
          </div>
          <button onclick="toggle('${b.id}')">
            ${collection.has(b.id)?"✓":"+"}
          </button>
        </div>
      `).join("")}
    </div>
  `;
}

function renderCollection(){
  const owned=brainrots.filter(b=>collection.has(b.id));
  app.innerHTML=owned.length?`
    <div class="grid">
      ${owned.map(b=>`
        <div class="card ${rarityClass(b.rarity)}">
          <div class="meta">
            <b>${b.name}</b>
            <small>${b.rarity}</small>
          </div>
        </div>
      `).join("")}
    </div>
  `:`<p style="color:#9aa4b2">No brainrots collected yet.</p>`;
}

function renderSettings(){
  app.innerHTML=`
    <button onclick="showImages=!showImages;render()">Toggle Images</button>
    <button onclick="resync()">Resync Wiki</button>
    <button onclick="clearData()">Clear Data</button>
  `;
}

/* ================= Actions ================= */
function toggle(id){
  collection.has(id)?collection.delete(id):collection.add(id);
  localStorage.setItem("sabCollection",JSON.stringify([...collection]));
  render();
}
function resync(){
  localStorage.removeItem("sabWikiCache");
  syncWiki();
}
function clearData(){
  localStorage.clear();
  location.reload();
}

/* ================= Init ================= */
const cache=localStorage.getItem("sabWikiCache");
if(cache){
  brainrots=JSON.parse(cache);
  status.textContent="Loaded from cache";
  render();
}
syncWiki();
</script>
</body>
</html>
